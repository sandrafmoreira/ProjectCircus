<template>
    <div class="main-section-graphic-el">
        <svg width="585" height="535" viewBox="0 0 585 535" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M99.7802 117.216C54.8993 -335.269 224.333 -36.6663 469.547 -107.088C853.457 -49.2291 909.916 81.941 790.771 214.526C647.661 270.206 520.487 328.696 452.364 271.068C339.1 113.22 119.663 317.668 99.7802 117.216Z" fill="#E4CB66"/>
            <path d="M328.773 493.477C328.483 493.477 328.194 493.322 328.049 492.856C323.123 475.302 324.862 453.554 326.455 438.641C327.18 432.272 328.049 425.903 328.773 419.69C330.512 406.486 332.25 392.971 332.829 379.301C333.843 355.378 330.222 335.805 322.834 323.999C322.544 323.688 322.544 323.222 322.834 322.912C323.123 322.601 323.558 322.601 323.848 322.912C323.848 322.912 323.848 323.067 323.992 323.067C331.67 335.184 335.292 355.067 334.278 379.301C333.699 392.971 331.96 406.641 330.222 419.845C329.353 426.059 328.483 432.583 327.904 438.797C326.31 453.554 324.717 475.147 329.497 492.39C329.642 492.856 329.353 493.166 329.063 493.322C328.773 493.322 328.773 493.322 328.773 493.477Z" fill="#E4CB66"/>
            <path d="M365.872 502.586C365.44 502.629 365.102 502.193 365.051 501.73C365.515 480.446 368.045 459.429 372.517 438.846C373.865 432.467 375.391 426.383 376.79 420.468C379.288 409.917 381.881 398.888 384.239 385.695C387.437 366.799 390.847 335.076 389.666 308.019C389.616 307.555 390.015 307.204 390.303 307.176C390.736 307.133 391.074 307.569 391.107 307.878C392.305 335.089 388.911 366.966 385.586 386.032C383.245 399.379 380.652 410.408 378.153 420.959C376.755 426.875 375.229 432.958 374.008 439.168C369.537 459.751 366.989 480.614 366.509 501.743C366.559 502.207 366.16 502.558 365.872 502.586Z" fill="#E4CB66"/>
            <path d="M238.841 534.549C238.977 534.501 239.193 534.26 239.328 534.212C247.893 513.665 243.485 481.936 238.494 453.888L237.461 447.628C232.347 418.464 227.03 388.377 231.591 364.266C231.751 363.88 231.445 363.49 231.061 363.294C230.676 363.097 230.324 363.386 230.165 363.773C225.581 388.223 230.954 418.455 236.068 447.619L237.101 453.879C242.036 481.782 246.467 513.172 238.061 533.332C237.902 533.719 238.072 534.156 238.456 534.352C238.513 534.498 238.705 534.596 238.841 534.549Z" fill="#E4CB66"/>
            <path d="M210.591 326.759C199.788 310.016 193.643 290.152 198.276 271.81C202.908 253.468 220.379 237.582 241.973 237.136C266.761 236.565 289.676 256.679 294.721 278.088C299.653 299.204 290.034 320.617 274.297 335.4C260.908 347.87 243.594 356.583 225.026 363.253C221.763 364.395 222.415 368.471 225.947 369.22C237.935 371.477 251.17 372.966 240.621 361.266C230.105 350.051 219.407 339.562 210.591 326.759Z" fill="#121B43"/>
            <path d="M278.648 328.502C266.624 318.715 257.932 305.045 257.208 289.356C256.484 273.511 265.176 255.647 280.821 246.326C300.379 234.676 326.165 238.87 339.927 253.161C353.69 267.453 355.863 288.89 350.358 308.463C345.722 325.395 335.871 340.929 324.571 355.221C323.123 357.085 325.006 359.26 327.324 358.483L337.899 355.065C341.666 353.823 342.245 349.162 338.624 348.23C336.306 347.454 333.843 346.832 331.38 346.677C326.02 346.832 321.529 348.386 316.169 347.454C302.841 345.124 288.355 336.424 278.648 328.502Z" fill="#5F977F"/>
            <path d="M334.9 248.734C330.022 239.998 326.069 230.39 325.508 219.826C324.813 208.026 328.237 196.603 335.132 187.651C346.503 172.951 366.625 166.451 383.437 168.396C409.097 171.348 427.502 192.033 430.178 216.757C432.787 240.863 421.214 267.139 402.624 286.45C396.088 293.337 388.459 299.55 383.287 306.928C381.282 309.935 379.877 314.445 382.927 315.708C384.612 316.48 386.851 315.636 388.802 314.82C393.135 313.146 411.839 308.347 408.117 303.558C406.586 301.522 400.256 300.893 397.689 300.051C394.063 298.845 390.404 297.329 386.872 295.645C373.099 289.498 360.467 280.429 349.906 268.97C344.304 262.96 339.194 256.121 334.9 248.734Z" fill="#192657"/>
            </svg>
      </div>
    <section class="main-section-pricing">
        <div>
            <h1 class="section-title " >Reserva a tua diversão!</h1>
            <p class="section-desc ">Explore os nossos pacotes de bilhetes, workshops <br>e descontos exclusivos para famílias e escolas. <br>Organize o seu dia no circo de forma fácil e acessível!</p>
        </div>
        
    </section>

    <!-- Programa Geral -->
    <section class="program-section">
        <div class="program-section-container" >

            <div class="program-graphic-el">
                <img style="margin-left: 100px;" src="/src/assets/PricingView/palhaço.png" alt="">
            </div>
            
            <div class="program-container">
                <h2 class="section-subtitle">Programa geral</h2>

                timeline
                <img src="/src/assets/PricingView/programa.png" alt="">
            </div>
        </div>
       
    </section>

    <!-- Preços -->
    
    <section class="prices">
        <h2 class="prices-title">Preços</h2>
        <img src="/src/assets/PricingView/bilheteAdulto.png" alt="">
        <img src="/src/assets/PricingView/bilheteCrianca.png" alt="">
        <img src="/src/assets/PricingView/bilhetePacote.png" alt="">
        <div class="cont-bilhete-instituicoes" style="width: 250px;">
            <img src="/src/assets/PricingView/bilheteInstituicoes.png" alt="" style="width: 250px;">
                <RouterLink :to="{name: 'contacts'}" class="btn-contactos">
                    Entrar em contacto
                    <img src="" alt="icon arrow">
                </RouterLink>
                
        </div>
    </section>

    <!-- Workshops -->
     <img style="width: 90vw; margin: 100px 0;" src="/src/assets/PricingView/workshops.png" alt="">

    <!-- Agendar Reserva -->
    <v-stepper :items="['Step 1', 'Step 2', 'Step 3', 'Step 4']">
        <template v-slot:item.1>
            <v-card title="Step One" flat>
                <h2>Faça a sua reserva</h2>
                <h3>Escolhe o dia e a bancada</h3>
                <p>Escolher data:</p>
                <ul>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                    <button>24/01/24</button><br>
                </ul>
                <p>Escolher zona:</p>
                <section>
                    <div>
                        <button>A</button>
                        <div>
                            <p>Adulto 20€</p>
                            <p>Criança 15€</p>
                        </div>
                    </div>
                    <br>
                    <div>
                        <button>B</button>
                        <div>
                            <p>Adulto 15€</p>
                            <p>Criança 12€</p>
                        </div>
                    </div>
                    <br>
                    <div>
                        <button>C</button>
                        <div>
                            <p>Adulto 12€</p>
                            <p>Criança 8€</p>
                        </div>
                    </div>
                    <br>
                </section>
            </v-card>
        </template>

        <template v-slot:item.2>
            <v-card title="Step Two" flat>
                <!-- Selected tickets -->
                <section>
                    <h2>Circo Illusionni</h2>
                    <p>20ª Edição - O circo e o Planeta</p>
                    <ul>
                        <li v-for="ticket in selectedTickets" :key="ticket.id">
                            <h3>{{ ticket.title }}</h3>
                            <p>{{ ticket.description }}</p>
                            <p>{{ ticket.price }}</p>
                            <p>quantity: {{ getTicketQuantity(ticket.id) }}</p>
                        </li>
                    </ul>
                </section>
                <h2>Escolhe os bilhetes</h2>
                <ul>
                    <li v-for="ticket in availableTickets" :key="ticket.id">
                        <h3>{{ ticket.title }}</h3>
                        <h3>{{ ticket.description }}</h3>
                        <h3>{{ ticket.price }}</h3>
                        <button @click="decreaseTicket(ticket)">-</button>
                        <span>{{ getTicketQuantity(ticket.id) }}</span>
                        <button @click="increaseTicket(ticket)">+</button>
                    </li>
                </ul>
            </v-card>
        </template>

        <template v-slot:item.3>
            <v-card title="Step Three" flat>
                <!-- Selected tickets -->
                <section>
                    <h2>Circo Illusionni</h2>
                    <p>20ª Edição - O circo e o Planeta</p>

                    <ul>
                        <li v-for="ticket in selectedTickets" :key="ticket.id">
                            <h3>{{ ticket.title }}</h3>
                            <p>{{ ticket.description }}</p>
                            <p>{{ ticket.price }}</p>
                            <p>quantity: {{ getTicketQuantity(ticket.id) }}</p>
                        </li>
                    </ul>
                </section>
                <h2>Adiciona workshops</h2>
                <ul>
                    <li v-for="workshop in availableWorkshops" :key="workshop.id">
                        <h3>{{ workshop.title }}</h3>
                        <h3>{{ workshop.description }}</h3>
                        <h3>{{ workshop.price }}</h3>
                        <button @click="decreaseWorkshop(workshop)">-</button>
                        <span>{{ getWorkshopQuantity(workshop.id) }}</span>
                        <button @click="increaseWorkshop(workshop)">+</button>
                    </li>
                </ul>
                <button @click="changeTab(4)" >Continuar</button>   
            </v-card>
        </template>

        <template v-slot:item.4>
            <v-card title="Step Four" flat>
                <!-- Selected tickets -->
                <section>
                    <h2>Circo Illusionni</h2>
                    <h3>20ª Edição - O circo e o Planeta</h3>

                    <div>
                        <img src="" alt="icon">
                        <p>{{ selectedDate }}</p>
                    </div>

                    <div>
                        <img src="" alt="icon">
                        <p>Parque da Cidade, Porto</p>
                    </div>

                    <div>
                        <p>{{ selectedTickets.length }} Bilhetes Zona {{ selectedZone }}</p>
                        <p>{{ selectedTickets.title }}</p>
                    </div>

                    <div>
                        <p>{{ selectedTickets.length }} </p>
                        <p>{{ selectedTickets.title }}</p>
                    </div>

                    <ul>
                        <p>{{ selectedTickets.length }} Bilhetes Zona {{ selectedZone }}</p>
                        <li v-for="ticket in selectedTickets" :key="ticket.id">
                            <p>quantity: {{ getTicketQuantity(ticket.id) }}</p> 
                            <h3>{{ ticket.title }}</h3>
                            <p>{{ ticket.price }}</p>
                        </li>
                    </ul>
                </section>

                <button @click="addToCart">Adicionar bilhetes ao carrinho</button> 
            </v-card>
        </template>
    </v-stepper>





    <!-- Selected tickets -->
    <section v-if="selectedTickets.length > 0">
        <h2>Circo Illusionni</h2>
        <p>20ª Edição - O circo e o Planeta</p>
        <ul>
            <li v-for="ticket in selectedTickets" :key="ticket.id">
                <h3>{{ ticket.title }}</h3>
                <p>{{ ticket.description }}</p>
                <p>{{ ticket.price }}</p>
                <p>quantity: {{ getTicketQuantity(ticket.id) }}</p>
            </li>
        </ul>
    </section>

    <section>
        <!-- Tab1 -->
        <div id="tab1" v-if="tabSelected == 1">
            <h2>Escolhe o dia e a bancada</h2>
            <button @click="changeTab(2)" >Continuar</button>
        </div>

        <!-- Tab2 -->
        <div id="tab2" v-else-if="tabSelected == 2">
            <h2>Escolhe os bilhetes</h2>
            <ul>
                <li v-for="ticket in availableTickets" :key="ticket.id">
                    <h3>{{ ticket.title }}</h3>
                    <h3>{{ ticket.description }}</h3>
                    <h3>{{ ticket.price }}</h3>
                    <button @click="decreaseTicket(ticket)">-</button>
                    <span>{{ getTicketQuantity(ticket.id) }}</span>
                    <button @click="increaseTicket(ticket)">+</button>
                </li>
            </ul>
            <button @click="changeTab(3)" >Continuar</button>
        </div>

        <!-- Tab3 -->
        <div id="tab3" v-else-if="tabSelected == 3">
            <h2>Adiciona workshops</h2>
            <ul>
                <li v-for="workshop in availableWorkshops" :key="workshop.id">
                    <h3>{{ workshop.title }}</h3>
                    <h3>{{ workshop.description }}</h3>
                    <h3>{{ workshop.price }}</h3>
                    <button @click="decreaseWorkshop(workshop)">-</button>
                    <span>{{ getWorkshopQuantity(workshop.id) }}</span>
                    <button @click="increaseWorkshop(workshop)">+</button>
                </li>
            </ul>
            <button @click="changeTab(4)" >Continuar</button>
        </div>

        <!-- Tab4 -->
        <div id="tab4" v-else-if="tabSelected == 4">
            <h2>Verifica</h2>
            <button @click="addToCart">Adicionar ao carrinho</button>
        </div>
    </section>
    <Footer></Footer>
</template>

<script>
    import { RouterLink, RouterView } from 'vue-router'
    import Footer from '@/components/Footer.vue';
    import { useTicketStore } from '@/stores/ticket'

    export default {
        components:{
            Footer
        },
        data() {
            return {
                tabSelected: 1,
                ticketStore: useTicketStore(),
                availableTickets: [
                    { id: 1, title: "Adulto", description: "Bilhete individual", price: "12.00€" },
                    { id: 2, title: "Criança", description: "Bilhete individual", price: "8.00€" },
                    { id: 3, title: "Pack Familiar", description: "2 adultos 2 crianças", price: "30.00€" },
                ],
                availableWorkshops: [
                    { id: 1, title: "Malabarismo Sustentável", description: "Limite de pessoas: 30", price: "4.00€" },
                    { id: 2, title: "Oficina de Acrobacias", description: "Limite de pessoas: 15", price: "6.00€" },
                    { id: 3, title: "Técnicas de Palhaçaria", description: "Limite de pessoas: 30", price: "4.00€" },
                ],
                selectedTickets: [], //To store selected tickets before adding them to the cart
                selectedWorkshops: [] //To store selected workshops before adding them to the cart
            }
        },
        methods: {
            changeTab(number) {
                this.tabSelected = number
            },
            increaseTicket(ticket) {
                //Check if ticket is already in selectedTickets
                const existingTicket = this.selectedTickets.find(t => t.id === ticket.id);
                if (existingTicket) {
                    existingTicket.quantity++;
                } else {
                    this.selectedTickets.push({ ...ticket, quantity: 1 });
                }
            },
            decreaseTicket(ticket) {
                const existingTicket = this.selectedTickets.find(t => t.id === ticket.id);
                if (existingTicket.quantity > 1) {
                    existingTicket.quantity--;
                } else if (existingTicket) {
                    this.selectedTickets = this.selectedTickets.filter(t => t.id !== ticket.id);
                }
            },
            getTicketQuantity(ticketId) {
                const ticket = this.selectedTickets.find(t => t.id === ticketId);
                return ticket ? ticket.quantity : 0;
            },
            increaseWorkshop(workshop) {
                //Check if ticket is already in selectedTickets
                const existingWorkshop = this.selectedWorkshops.find(w => w.id === workshop.id);
                if (existingWorkshop) {
                    existingWorkshop.quantity++;
                } else {
                    this.selectedWorkshops.push({ ...workshop, quantity: 1 });
                }
            },
            decreaseWorkshop(workshop) {
                const existingWorkshop = this.selectedWorkshops.find(w => w.id === workshop.id);
                if (existingWorkshop.quantity > 1) {
                    existingWorkshop.quantity--;
                } else if (existingWorkshop) {
                    this.selectedWorkshops = this.selectedWorkshops.filter(w => w.id !== workshop.id);
                }
            },
            getWorkshopQuantity(workshopId) {
                const workshop = this.selectedWorkshops.find(w => w.id === workshopId);
                return workshop ? workshop.quantity : 0;
            },
            addToCart() {
                //Add all selected tickets to the store
                this.selectedTickets.forEach(ticket => {
                    for (let i = 0; i < ticket.quantity; i++) {
                    this.ticketStore.addPurchasedTicket(ticket);
                    }
                });

                this.selectedTickets = [];
                alert("Tickets added to cart successfully. They will now show up on Histórico de Produtos.");
            },
        },
    }
</script>

<style scoped>

    .main-section-pricing{
        display: grid;
        grid-template-columns: 50% 50%;
        padding-top: 8rem;
        padding-bottom: 8rem;
    }

    .main-section-graphic-el{
        position: absolute; 
        z-index: -1;
        right: 0;
        transform: translateY(-8%);
    }

    .program {
        display: flex;
        flex-wrap: wrap;
        margin: 50px 0;
        width: 95vw;
        gap: 150px;
    }

    .program-title {
        margin-left: 180px;
        padding: 30px;
    }

    .prices-title {
        margin: 150px 0 20px 0;
    }
    .prices {
        display: flex;  
        flex-wrap: wrap;
        justify-content: space-around; 
        align-items: flex-start;
        gap: 30px
    }

    .prices > img {
        width: 250px;
    }

    .cont-bilhete-instituicoes {
        position: relative;
    }

    .btn-contactos {
        position: absolute;
        bottom: 10px;         
        left: 5px; 
        background-color: #E63946;
        color: white;
        padding: 10px 20px;
        border-radius: 100px;
    }


</style>